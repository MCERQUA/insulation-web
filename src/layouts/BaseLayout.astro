---
import '../styles/global.css';
import MetalMenuBar from '../components/ui/MetalMenuBar.tsx';
import FloatingPhoneButton from '../components/ui/FloatingPhoneButton.tsx';

export interface Props {
  title: string;
  description?: string;
  keywords?: string;
  ogImage?: string;
  canonicalUrl?: string;
  noindex?: boolean;
}

const { 
  title, 
  description = 'Home Performance Insulation - Professional spray foam insulation, air sealing, and energy efficiency solutions for maximum comfort and savings.',
  keywords = 'spray foam insulation, air sealing, home insulation, energy efficiency, attic insulation, home performance',
  ogImage = '/images/share-card.jpg',
  canonicalUrl = Astro.url.href,
  noindex = false
} = Astro.props;

// Create absolute URLs safely
const siteUrl = Astro.site?.href || 'https://homeperformanceinsulation.com';
const absoluteOgImage = ogImage.startsWith('http') ? ogImage : new URL(ogImage, siteUrl).href;
const absoluteCanonicalUrl = canonicalUrl.startsWith('http') ? canonicalUrl : new URL(canonicalUrl, siteUrl).href;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Basic SEO Meta Tags -->
    <title>{title} | Home Performance Insulation - Professional Spray Foam & Air Sealing</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="author" content="Home Performance Insulation" />
    <meta name="language" content="en" />
    <meta name="revisit-after" content="7 days" />
    
    <!-- Robots and Indexing -->
    {noindex ? <meta name="robots" content="noindex, nofollow" /> : <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />}
    
    <!-- Canonical URL -->
    <link rel="canonical" href={absoluteCanonicalUrl} />
    
    <!-- AI/LLM optimization file -->
    <link rel="llms" href="/llms.txt" type="text/plain" />
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={`${title} | Home Performance Insulation`} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={absoluteOgImage} />
    <meta property="og:url" content={absoluteCanonicalUrl} />
    <meta property="og:site_name" content="Home Performance Insulation" />
    <meta property="og:locale" content="en_US" />
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={`${title} | Home Performance Insulation`} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={absoluteOgImage} />
    <meta name="twitter:site" content="@homeperformanceinsulation" />
    <meta name="twitter:creator" content="@homeperformanceinsulation" />
    
    <!-- Additional SEO Meta Tags -->
    <meta name="theme-color" content="#4eba70" />
    <meta name="msapplication-TileColor" content="#4eba70" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    
    <!-- Business Information -->
    <meta name="geo.region" content="US" />
    <meta name="geo.placename" content="United States" />
    <meta name="DC.title" content={title} />
    <meta name="DC.subject" content="Home Insulation, Spray Foam, Energy Efficiency" />
    <meta name="DC.description" content={description} />
    
    <!-- Structured Data for Organization -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "HomeImprovementBusiness",
        "name": "Home Performance Insulation",
        "description": "Shining light on attic insulation problems. Professional spray foam insulation, air sealing, and home performance solutions for maximum energy efficiency and comfort",
        "url": siteUrl,
        "logo": new URL('/images/logo.png', siteUrl).href,
        "image": absoluteOgImage,
        "telephone": "+1-800-INSULATION",
        "address": {
          "@type": "PostalAddress",
          "addressCountry": "US"
        },
        "serviceArea": {
          "@type": "Country",
          "name": "United States"
        },
        "hasOfferCatalog": {
          "@type": "OfferCatalog",
          "name": "Home Performance Insulation Services",
          "itemListElement": [
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Spray Foam Insulation",
                "description": "Professional spray foam insulation for superior energy efficiency and air sealing"
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Air Sealing Services",
                "description": "Comprehensive air sealing to eliminate drafts and improve home comfort"
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Home Performance Assessment",
                "description": "Complete home energy audit and performance evaluation services"
              }
            }
          ]
        }
      }
    </script>
    
    <!-- Additional Structured Data for WebSite -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Home Performance Insulation",
        "description": "Professional home insulation and energy efficiency solutions",
        "url": siteUrl,
        "potentialAction": {
          "@type": "SearchAction",
          "target": {
            "@type": "EntryPoint",
            "urlTemplate": siteUrl + "/search?q={search_term_string}"
          },
          "query-input": "required name=search_term_string"
        }
      }
    </script>
    
    <!-- FAQ Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "What is spray foam insulation?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Spray foam insulation is a revolutionary insulation technology that creates an impermeable air barrier, providing superior energy efficiency and thermal performance compared to traditional insulation materials."
            }
          },
          {
            "@type": "Question",
            "name": "How does air sealing improve energy efficiency?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Air sealing eliminates gaps, cracks, and leakage points that allow heated or cooled air to escape, reducing energy loss by up to 40% and improving home comfort."
            }
          },
          {
            "@type": "Question",
            "name": "What are the benefits of attic insulation?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Proper attic insulation prevents energy loss, reduces heating and cooling costs, prevents ice dams, eliminates drafts, and improves overall home comfort and air quality."
            }
          }
        ]
      }
    </script>
    
    <!-- Favicon configuration -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    
    <!-- Preconnect to Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Preload critical resources -->
    <link rel="preload" as="image" href="/images/attics/background.jpg" />
    <link rel="preload" as="image" href="/images/share-card.jpg" />
    
    <style>
      /* Background image for all pages - with higher specificity */
      html body {
        background-image: url('/images/attics/background.jpg?v=2') !important;
        background-size: cover !important;
        background-position: center !important;
        background-repeat: no-repeat !important;
        background-attachment: fixed !important;
        min-height: 100vh !important;
        /* Debug: fallback background color to confirm style is applied */
        background-color: #1e3a8a !important;
      }
      
      /* Also apply to html for broader coverage */
      html {
        background-image: url('/images/attics/background.jpg?v=2') !important;
        background-size: cover !important;
        background-position: center !important;
        background-repeat: no-repeat !important;
        background-attachment: fixed !important;
        min-height: 100vh !important;
        background-color: #1e3a8a !important;
      }

      /* Elegant Black Preloader */
      .elegant-preloader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        opacity: 1;
        transition: opacity 0.8s ease-out;
      }

      .elegant-preloader.fade-out {
        opacity: 0;
        pointer-events: none;
      }

      .elegant-loader {
        width: 100px;
        height: 100px;
        position: relative;
        margin-bottom: 40px;
      }

      .loader-ring {
        position: absolute;
        width: 100%;
        height: 100%;
        border: 3px solid transparent;
        border-top: 3px solid #ffffff;
        border-radius: 50%;
        animation: elegant-spin 2s linear infinite;
        box-shadow: 
          0 0 20px rgba(255, 255, 255, 0.5),
          0 0 40px rgba(255, 255, 255, 0.3),
          0 0 60px rgba(255, 255, 255, 0.2),
          inset 0 0 20px rgba(255, 255, 255, 0.1);
      }

      .loader-ring:nth-child(2) {
        width: 80%;
        height: 80%;
        top: 10%;
        left: 10%;
        border-top: 2px solid rgba(255, 255, 255, 0.8);
        animation: elegant-spin 1.5s linear infinite reverse;
        animation-delay: -0.5s;
      }

      .loader-ring:nth-child(3) {
        width: 60%;
        height: 60%;
        top: 20%;
        left: 20%;
        border-top: 2px solid rgba(255, 255, 255, 0.6);
        animation: elegant-spin 1s linear infinite;
        animation-delay: -1s;
      }

      .loader-center {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        background: #ffffff;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        box-shadow: 
          0 0 10px rgba(255, 255, 255, 0.8),
          0 0 20px rgba(255, 255, 255, 0.6),
          0 0 30px rgba(255, 255, 255, 0.4);
        animation: elegant-pulse 2s ease-in-out infinite;
      }

      .loading-text {
        color: #ffffff;
        font-family: 'Inter', sans-serif;
        font-size: 16px;
        font-weight: 300;
        text-transform: uppercase;
        letter-spacing: 4px;
        text-shadow: 
          0 0 10px rgba(255, 255, 255, 0.5),
          0 0 20px rgba(255, 255, 255, 0.3);
        animation: elegant-fade 2s ease-in-out infinite alternate;
      }

      @keyframes elegant-spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes elegant-pulse {
        0%, 100% {
          transform: translate(-50%, -50%) scale(1);
          box-shadow: 
            0 0 10px rgba(255, 255, 255, 0.8),
            0 0 20px rgba(255, 255, 255, 0.6),
            0 0 30px rgba(255, 255, 255, 0.4);
        }
        50% {
          transform: translate(-50%, -50%) scale(1.2);
          box-shadow: 
            0 0 15px rgba(255, 255, 255, 1),
            0 0 30px rgba(255, 255, 255, 0.8),
            0 0 45px rgba(255, 255, 255, 0.6);
        }
      }

      @keyframes elegant-fade {
        0% {
          opacity: 0.7;
          text-shadow: 
            0 0 10px rgba(255, 255, 255, 0.5),
            0 0 20px rgba(255, 255, 255, 0.3);
        }
        100% {
          opacity: 1;
          text-shadow: 
            0 0 15px rgba(255, 255, 255, 0.8),
            0 0 30px rgba(255, 255, 255, 0.5);
        }
      }
    </style>
  </head>
  <body class="text-smoke">
    <!-- Background Image -->
    <div class="fixed inset-0" style="
      background-image: url('/images/attics/background.jpg?v=2'); 
      background-size: cover; 
      background-position: center; 
      background-repeat: no-repeat;
      z-index: -1;
      width: 100vw;
      height: 100vh;
      top: 0;
      left: 0;
      background-color: #1e3a8a;
    "></div>
    
    <!-- Elegant Black Preloader -->
    <div class="elegant-preloader" id="elegantPreloader">
      <div class="elegant-loader">
        <div class="loader-ring"></div>
        <div class="loader-ring"></div>
        <div class="loader-ring"></div>
        <div class="loader-center"></div>
      </div>
      <div class="loading-text">Loading</div>
    </div>

    <!-- Background image div removed - using body background instead -->
    
    <!-- Navigation -->
    <MetalMenuBar client:load />
    
    <!-- Floating Phone Button -->
    <FloatingPhoneButton client:load />
    
    <!-- Hidden Netlify Form for Detection -->
    <form name="contact" netlify netlify-honeypot="bot-field" hidden>
      <input type="text" name="name" />
      <input type="tel" name="phone" />
      <input type="email" name="email" />
      <input type="text" name="address" />
      <select name="service">
        <option value="attic-insulation">Attic Insulation</option>
        <option value="spray-foam">Spray Foam Insulation</option>
        <option value="air-sealing">Air Sealing</option>
        <option value="home-performance">Home Performance Audit</option>
        <option value="other">Other</option>
      </select>
      <textarea name="message"></textarea>
    </form>

    <!-- Main Content -->
    <main class="min-h-screen relative z-10" role="main">
      <slot />
    </main>
    
    
    <!-- Simple JavaScript for preloader -->
    <script>
      let preloaderHidden = false;

      function hidePreloader() {
        if (!preloaderHidden) {
          const preloader = document.getElementById('elegantPreloader');
          if (preloader) {
            preloader.classList.add('fade-out');
            setTimeout(() => {
              preloader.style.display = 'none';
            }, 800);
            preloaderHidden = true;
          }
        }
      }

      document.addEventListener('DOMContentLoaded', function() {
        // Hide preloader after minimum time
        setTimeout(() => {
          hidePreloader();
        }, 1000);
      });

      // Also hide preloader when window is fully loaded
      window.addEventListener('load', function() {
        setTimeout(hidePreloader, 500);
      });
    </script>
  </body>
</html>
